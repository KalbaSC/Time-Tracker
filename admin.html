<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© | Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨ØµÙ…Ø© - Ù†Ø§Ø¯ÙŠ ÙƒÙ„Ø¨Ø§Ø¡</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800;900&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b0b0b; --card:#111213; --accent:#f6c21a; --accent-2:#1f1f1f;
      --text:#f2f2f2; --muted:#aaaaaa; --ok:#14b86a; --bad:#ef4444;
      --radius:18px; --shadow:0 6px 20px rgba(0,0,0,.25);
      font-family:"Tajawal",system-ui,-apple-system,Segoe UI,Roboto,Arial,"Noto Kufi Arabic",sans-serif;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%;background:var(--bg);color:var(--text)}
    a{color:var(--accent);text-decoration:none}
    .container{max-width:1200px;margin:0 auto;padding:24px;min-height:100vh;display:flex;flex-direction:column}
    .header{display:flex;gap:16px;align-items:center;justify-content:space-between;margin-bottom:18px;flex-wrap:wrap}
    .brand{display:flex;align-items:center;gap:12px}
    .brand img{width:44px;height:44px;border-radius:50%;object-fit:cover;border:2px solid var(--accent)}
    .brand-title{font-weight:800;letter-spacing:.5px}
    .card{background:linear-gradient(180deg,#141515,#0f0f0f);border:1px solid #1f1f1f;border-radius:var(--radius);box-shadow:var(--shadow);padding:20px;margin-bottom:20px}
    .card h2{margin:0 0 12px 0;font-size:20px;color:var(--accent)}
    label{display:block;margin-bottom:6px;color:var(--muted);font-size:14px}
    input,select,button{width:100%;padding:12px;border-radius:12px;border:1px solid #2a2a2a;background:#0f0f0f;color:var(--text);transition:all .25s ease}
    input:focus,select:focus{outline:none;border-color:var(--accent)}
    button{cursor:pointer;background:var(--accent);color:#111;border-color:#d4a412;font-weight:800}
    button:hover{background:#ffda41;transform:translateY(-2px)}
    button.secondary{background:#1c1c1c;color:var(--text);border-color:#2b2b2b}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    .col{flex:1 1 260px}
    .note{color:var(--muted);font-size:13px}
    .two{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .table{width:100%;border-collapse:collapse}
    .table th,.table td{border-bottom:1px solid #222;padding:10px;text-align:right}
    .small{font-size:12px}
    .badge{display:inline-block;padding:4px 10px;border-radius:999px;background:#1f1f1f;border:1px solid #2a2a2a;color:#aaa;font-size:12px}
    .kpi{background:#0f0f0f;border:1px solid #212121;border-radius:14px;padding:16px;text-align:center}
    .kpi .v{font-size:22px;font-weight:900;margin-top:4px}
    .toolbar{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .btn-danger{background:#2a1212;border-color:#4a1e1e;color:#f4b4b4}
    @media(max-width:900px){.two{grid-template-columns:1fr} .container{padding:16px}}
  </style>
</head>
<body>
  <div class="container">
    <header class="header">
      <div class="brand">
        <img src="logo.png" alt="Kalba SC Logo" />
        <div class="brand-title">Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨ØµÙ…Ø© â€” Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©</div>
      </div>
      <span class="badge" id="authTag">ØºÙŠØ± Ù…Ø³Ø¬Ù„</span>
    </header>

    <main>
      <!-- HR Login -->
      <section id="gateBox" class="card">
        <h2>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h2>
        <div class="row">
          <div class="col">
            <label>Ø±Ù…Ø² Ù…Ø¯ÙŠØ± Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ© (HR)</label>
            <input id="adminPass" type="password" placeholder="Ù…Ø«Ø§Ù„: kalbaHR2025">
          </div>
          <div class="col">
            <button id="btnAdminLogin">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</button>
          </div>
          <div class="col">
            <button id="btnLogout" class="secondary">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
          </div>
        </div>
        <p id="gateMsg" class="note" style="margin-top:6px"></p>
      </section>

      <!-- HR Dashboard -->
      <section id="adminBox" class="card" style="display:none">
        <div class="toolbar" style="justify-content:space-between;margin-bottom:10px">
          <h2>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
          <span class="badge">Ø§Ù„Ø§ØªØµØ§Ù„: Ù…Ø­Ù„ÙŠ</span>
        </div>

        <!-- KPIs -->
        <div class="row" style="margin-bottom:12px">
          <div class="col kpi"><div class="t">Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</div><div id="kEmployees" class="v">0</div></div>
          <div class="col kpi"><div class="t">Ù†Ø´Ø·ÙˆÙ† Ø§Ù„ÙŠÙˆÙ…</div><div id="kActiveToday" class="v">0</div></div>
          <div class="col kpi"><div class="t">Ø·Ù„Ø¨Ø§Øª Ø¥Ø¬Ø§Ø²Ø©</div><div id="kLeaves" class="v">0</div></div>
        </div>

        <div class="two">
          <!-- Employees Management -->
          <div class="card">
            <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h2>
            <div class="row">
              <div class="col">
                <label>Ø§Ù„Ø§Ø³Ù…</label>
                <input id="empNameIn" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ">
              </div>
              <div class="col">
                <label>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</label>
                <input id="empIdIn" placeholder="Ù…Ø«Ø§Ù„: 12034">
              </div>
              <div class="col">
                <label>Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ (PIN)</label>
                <input id="empPinIn" type="password" inputmode="numeric" placeholder="4â€“6 Ø£Ø±Ù‚Ø§Ù…">
              </div>
              <div class="col">
                <label>Ø§Ù„Ø­Ø§Ù„Ø©</label>
                <select id="empActiveIn">
                  <option value="1">Ù†Ø´Ø·</option>
                  <option value="0">Ù…ÙˆÙ‚ÙˆÙ</option>
                </select>
              </div>
            </div>
            <div class="toolbar" style="margin-top:8px">
              <button id="btnAddEmp">â• Ø¥Ø¶Ø§ÙØ© / ØªØ­Ø¯ÙŠØ«</button>
              <button id="btnDelEmp" class="btn-danger">ğŸ—‘ï¸ Ø­Ø°Ù</button>
              <button id="btnExportEmployees" class="secondary">ğŸ“¥ ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† (CSV)</button>
            </div>
            <div style="margin-top:10px;max-height:320px;overflow:auto;border:1px solid #222;border-radius:12px">
              <table class="table">
                <thead><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø±Ù‚Ù…</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th></tr></thead>
                <tbody id="empTable"><tr><td colspan="3" class="small">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙˆØ¸ÙÙˆÙ† Ø¨Ø¹Ø¯.</td></tr></tbody>
              </table>
            </div>
          </div>

          <div class="card">
            <h2>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h2>
            <div class="row">
              <div class="col">
                <label>Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„ (Ø§Ù„Ø£Ø­Ø¯â€“Ø§Ù„Ø®Ù…ÙŠØ³)</label>
                <input id="confWDDuration" value="7" type="number" min="0" step="0.5">
                <div class="note small">Ø§ÙØªØ±Ø§Ø¶ÙŠÙ‹Ø§ 7 Ø³Ø§Ø¹Ø§Øª.</div>
              </div>
              <div class="col">
                <label>Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø³Ø¨Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                <input id="confSatDuration" value="3" type="number" min="0" step="0.5">
              </div>
              <div class="col">
                <label>ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</label>
                <input id="confAdminPass" type="password" placeholder="kalbaHR2025">
              </div>
            </div>
            <div class="toolbar" style="margin-top:8px">
              <button id="btnSaveSettings">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
            </div>
          </div>
        </div>

        <div class="card">
          <h2>Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª</h2>
          <div class="row">
            <div class="col">
              <label>Ø§Ù„Ù…ÙˆØ¸Ù (Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ¸ÙŠÙÙŠ)</label>
              <input id="lvEmpId" placeholder="1234">
            </div>
            <div class="col">
              <label>Ø§Ù„Ù†ÙˆØ¹</label>
              <select id="lvType">
                <option value="Sick">Ù…Ø±Ø¶ÙŠØ©</option>
                <option value="Annual">Ø³Ù†ÙˆÙŠØ©</option>
                <option value="Unpaid">Ø¨Ø¯ÙˆÙ† Ø±Ø§ØªØ¨</option>
                <option value="Other">Ø£Ø®Ø±Ù‰</option>
              </select>
            </div>
            <div class="col">
              <label>Ù…Ù† ØªØ§Ø±ÙŠØ®</label>
              <input id="lvFrom" type="date">
            </div>
            <div class="col">
              <label>Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label>
              <input id="lvTo" type="date">
            </div>
            <div class="col">
              <label>Ù…Ù„Ø§Ø­Ø¸Ø©</label>
              <input id="lvNote" placeholder="ØªÙØ§ØµÙŠÙ„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
            </div>
          </div>
          <div class="toolbar" style="margin-top:8px">
            <button id="btnAddLeave">â• ØªØ³Ø¬ÙŠÙ„ Ø¥Ø¬Ø§Ø²Ø©</button>
            <button id="btnExportLeaves" class="secondary">ğŸ“¥ ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø§Øª (CSV)</button>
          </div>
          <div style="margin-top:10px;max-height:320px;overflow:auto;border:1px solid #222;border-radius:12px">
            <table class="table">
              <thead><tr><th>Ø§Ù„Ø±Ù‚Ù…</th><th>Ø§Ù„Ù†ÙˆØ¹</th><th>Ù…Ù†</th><th>Ø¥Ù„Ù‰</th><th>Ù…Ù„Ø§Ø­Ø¸Ø©</th></tr></thead>
              <tbody id="lvTable"><tr><td colspan="5" class="small">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ø¨Ø¹Ø¯.</td></tr></tbody>
            </table>
          </div>
        </div>
      </section>
    </main>

    <footer class="note" style="margin-top:auto;padding-top:10px;text-align:center">Â© Ù†Ø§Ø¯ÙŠ ÙƒÙ„Ø¨Ø§Ø¡ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠ Ø§Ù„Ø«Ù‚Ø§ÙÙŠ</footer>
  </div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxJt7_TgpIu6F9gN9-Vn_r3U3bIk5t-b77Pn1Jv4oJfU5YF1qKTOY-nTiRZOpUdtgQT/exec";
const $ = id => document.getElementById(id);

// ==== Helper to send to Apps Script (no-cors mode) ====
async function postToScript(action, payload = {}) {
  try {
    await fetch(SCRIPT_URL, {
      method: "POST",
      mode: "no-cors", // âœ… bypasses CORS
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ action, payload }),
    });
    console.log("âœ… Request sent to Google Apps Script (no-cors)");
    return { ok: true };
  } catch (err) {
    console.error("âŒ Script connection error:", err);
    alert("âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ Google Sheet. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ø£Ùˆ Ø±Ø§Ø¨Ø· Ø§Ù„Ø³ÙƒØ±Ø¨Øª.");
    return { ok: false };
  }
}

// ===== Auth =====
function refreshAuth() {
  const logged = sessionStorage.getItem("kscAdminLogged") === "1";
  $("authTag").textContent = logged ? "Ø¥Ø¯Ø§Ø±ÙŠ" : "ØºÙŠØ± Ù…Ø³Ø¬Ù„";
  $("gateBox").style.display = "";
  $("adminBox").style.display = logged ? "" : "none";
}

function initGate() {
  $("btnAdminLogin").onclick = () => {
    const pass = ($("adminPass").value || "").trim();
    if (pass === "kalbaHR2025") {
      sessionStorage.setItem("kscAdminLogged", "1");
      refreshAll();
    } else alert("Ø±Ù…Ø² Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ØºÙŠØ± ØµØ­ÙŠØ­.");
  };
  $("btnLogout").onclick = () => {
    sessionStorage.removeItem("kscAdminLogged");
    refreshAuth();
  };
}

// ===== Employees =====
async function addOrUpdateEmp() {
  const name = ($("empNameIn").value || "").trim();
  const id = ($("empIdIn").value || "").trim();
  const pin = ($("empPinIn").value || "").trim();
  const active = $("empActiveIn").value === "1";
  if (!name || !id || !pin) return alert("Ø£Ø¯Ø®Ù„ÙŠ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ¸ÙŠÙÙŠ ÙˆØ§Ù„Ù€ PIN.");

  await postToScript("addEmployee", { id, name, pin, active });
  alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…ÙˆØ¸Ù ÙÙŠ Google Sheet.");
}

async function deleteEmp() {
  const id = ($("empIdIn").value || "").trim();
  if (!id) return alert("Ø£Ø¯Ø®Ù„ÙŠ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ¸ÙŠÙÙŠ.");
  if (!confirm("ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¸Ù Ù…Ù† Google SheetØŸ")) return;
  await postToScript("deleteEmployee", { id });
  alert("ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¸Ù Ù…Ù† Google Sheet.");
}

// ===== Leaves =====
async function addLeave() {
  const id = ($("lvEmpId").value || "").trim();
  const type = $("lvType").value;
  const from = $("lvFrom").value;
  const to = $("lvTo").value || from;
  const note = ($("lvNote").value || "").trim();
  if (!id || !from) return alert("Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ¸ÙŠÙÙŠ ÙˆØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ù…Ø·Ù„ÙˆØ¨Ø§Ù†.");
  await postToScript("addLeave", { id, type, from, to, note });
  alert("âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¥Ø¬Ø§Ø²Ø© ÙÙŠ Google Sheet.");
}

// ===== Placeholder: KPIs and table refresh =====
// Since we canâ€™t read responses in no-cors mode,
// you can just show static info or use Google Sheet dashboard.

function refreshAll() {
  refreshAuth();
  const logged = sessionStorage.getItem("kscAdminLogged") === "1";
  if (!logged) return;
  $("kEmployees").textContent = "â€”";
  $("kLeaves").textContent = "â€”";
}

document.addEventListener("DOMContentLoaded", () => {
  initGate();
  $("btnAddEmp").onclick = addOrUpdateEmp;
  $("btnDelEmp").onclick = deleteEmp;
  $("btnAddLeave").onclick = addLeave;
  $("btnSaveSettings").onclick = () => alert("Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© (Ù…Ø­Ù„ÙŠ ÙÙ‚Ø·).");
  refreshAll();
});
</script>

</body>
</html>
